# ğŸ¯ æ™ºèƒ½æ¨èç³»ç»Ÿå®ç°æŒ‡å—

## æ¦‚è¿°

æ™ºèƒ½æ¨èç³»ç»Ÿæ˜¯ Stardew Sage é¡¹ç›®çš„å¢å¼ºåŠŸèƒ½ï¼ŒåŸºäº **Spring AI** å’Œ **Redis Vector Store** å®ç°ï¼Œæä¾›ä¸ªæ€§åŒ–çš„æ¸¸æˆå†…å®¹æ¨èã€‚

## âœ¨ æ ¸å¿ƒç‰¹æ€§

### 1. ä¸ªæ€§åŒ–æ¨è
- åŸºäºå‘é‡ç›¸ä¼¼åº¦çš„å†…å®¹æ¨è
- æ”¯æŒè‡ªç„¶è¯­è¨€æŸ¥è¯¢
- å¤šç»´åº¦æ¨èè¯„åˆ†

### 2. ç­–ç•¥å»ºè®®
- AI é©±åŠ¨çš„ç­–ç•¥åˆ†æ
- å®æ—¶æµå¼å“åº”
- åœºæ™¯åŒ–çš„æ¸¸æˆå»ºè®®

### 3. ä¸Šä¸‹æ–‡æ¨è
- ç»“åˆå†å²å¯¹è¯çš„æ™ºèƒ½æ¨è
- å¤šè½®å¯¹è¯æ”¯æŒ
- ä¸ªæ€§åŒ–å†…å®¹è¿‡æ»¤

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å‰ç«¯ Vue.js                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ä¸ªæ€§åŒ–æ¨è   â”‚   ç­–ç•¥å»ºè®®    â”‚    ä¸Šä¸‹æ–‡æ¨è      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ HTTP / SSE
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              RecommendationController                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚         REST API Endpoints                     â”‚    â”‚
â”‚  â”‚  /personalized | /strategy | /contextual       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              RecommendationService                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ å‘é‡æœç´¢     â”‚  AI åˆ†æ     â”‚   å¤šæ ·åŒ–è¿‡æ»¤    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Redis Vector  â”‚  â”‚   Spring AI     â”‚
â”‚    Store      â”‚  â”‚   ChatClient    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ æ–‡ä»¶ç»“æ„

```
aurora-mcp/src/main/java/com/zzk/mcp/
â”œâ”€â”€ model/
â”‚   â””â”€â”€ Recommendation.java          # æ¨èç»“æœå®ä½“
â”œâ”€â”€ service/
â”‚   â””â”€â”€ RecommendationService.java   # æ¨èæœåŠ¡æ ¸å¿ƒé€»è¾‘
â””â”€â”€ controller/
    â””â”€â”€ RecommendationController.java # REST API æ§åˆ¶å™¨

aurora-ui/src/views/stardew/
â””â”€â”€ recommendation/
    â””â”€â”€ index.vue                    # æ¨èç³»ç»Ÿå‰ç«¯ç•Œé¢
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### åç«¯é…ç½®

1. **ç¡®ä¿ Redis Vector Store å·²é…ç½®**

åœ¨ `aurora-mcp/src/main/resources/application.yml` ä¸­ï¼š

```yaml
spring:
  data:
    redis:
      host: localhost
      port: 6379
  ai:
    vectorstore:
      redis:
        index-name: stardew_index
        initialize-schema: true
```

2. **å¯åŠ¨ MCP æœåŠ¡**

```bash
cd aurora-mcp
mvn spring-boot:run
```

æœåŠ¡å°†åœ¨ `http://localhost:8099` å¯åŠ¨

### å‰ç«¯é…ç½®

1. **æ·»åŠ è·¯ç”±é…ç½®**

åœ¨ `aurora-ui/src/router/index.js` ä¸­æ·»åŠ ï¼š

```javascript
{
  path: '/stardew/recommendation',
  component: () => import('@/views/stardew/recommendation/index'),
  name: 'Recommendation',
  meta: { title: 'æ™ºèƒ½æ¨è', icon: 'star' }
}
```

2. **å¯åŠ¨å‰ç«¯æœåŠ¡**

```bash
cd aurora-ui
npm run dev
```

è®¿é—® `http://localhost:80/stardew/recommendation`

## ğŸ“¡ API æ¥å£æ–‡æ¡£

### 1. è·å–ä¸ªæ€§åŒ–æ¨è

**ç«¯ç‚¹**: `GET /api/recommendation/personalized`

**å‚æ•°**:
- `query` (string, å¿…éœ€): ç”¨æˆ·æŸ¥è¯¢
- `topK` (int, å¯é€‰): è¿”å›æ•°é‡ï¼Œé»˜è®¤ 5

**å“åº”**:
```json
[
  {
    "itemId": "1",
    "itemName": "è‰è“ç§å­",
    "itemType": "crop",
    "score": 0.92,
    "reason": "åŸºäºå‘é‡ç›¸ä¼¼åº¦åŒ¹é…",
    "source": "content_based",
    "metadata": {}
  }
]
```

### 2. è·å–ç­–ç•¥å»ºè®®

**ç«¯ç‚¹**: `GET /api/recommendation/strategy`

**å‚æ•°**:
- `scenario` (string, å¿…éœ€): åœºæ™¯æè¿°

**å“åº”**: æµå¼æ–‡æœ¬ (SSE)

**ç¤ºä¾‹**:
```bash
curl -N "http://localhost:8099/api/recommendation/strategy?scenario=æ˜¥å­£ç¬¬ä¸€å‘¨ï¼Œ500é‡‘å¸"
```

### 3. è·å–ä¸Šä¸‹æ–‡æ¨è

**ç«¯ç‚¹**: `GET /api/recommendation/contextual`

**å‚æ•°**:
- `context` (string, å¯é€‰): ä¸Šä¸‹æ–‡ä¿¡æ¯
- `query` (string, å¿…éœ€): ç”¨æˆ·é—®é¢˜

**å“åº”**: æµå¼æ–‡æœ¬ (SSE)

### 4. è·å–ç›¸ä¼¼å†…å®¹

**ç«¯ç‚¹**: `GET /api/recommendation/similar`

**å‚æ•°**:
- `itemId` (string, å¿…éœ€): ç‰©å“ ID
- `itemType` (string, å¿…éœ€): ç‰©å“ç±»å‹
- `topK` (int, å¯é€‰): è¿”å›æ•°é‡ï¼Œé»˜è®¤ 5

## ğŸ’» ä½¿ç”¨ç¤ºä¾‹

### å‰ç«¯è°ƒç”¨ç¤ºä¾‹

```javascript
// è·å–ä¸ªæ€§åŒ–æ¨è
async getRecommendations() {
  const response = await this.$http.get('/api/recommendation/personalized', {
    params: {
      query: 'æœ€èµšé’±çš„ä½œç‰©',
      topK: 5
    }
  });
  console.log(response.data);
}

// è·å–ç­–ç•¥å»ºè®®ï¼ˆSSEï¼‰
getStrategyAdvice() {
  const url = 'http://localhost:8099/api/recommendation/strategy?scenario=æ–°æ‰‹ç©å®¶';
  const eventSource = new EventSource(url);
  
  eventSource.onmessage = (event) => {
    console.log('æ”¶åˆ°æ•°æ®:', event.data);
  };
}
```

### åç«¯æ‰©å±•ç¤ºä¾‹

```java
@Service
public class CustomRecommendationService {
    
    @Autowired
    private RecommendationService recommendationService;
    
    /**
     * è‡ªå®šä¹‰æ¨èé€»è¾‘
     */
    public List<Recommendation> getCustomRecommendations(String userId) {
        // 1. è·å–ç”¨æˆ·ç”»åƒ
        UserProfile profile = getUserProfile(userId);
        
        // 2. åŸºäºç”»åƒç”ŸæˆæŸ¥è¯¢
        String query = buildQueryFromProfile(profile);
        
        // 3. è·å–æ¨è
        List<Recommendation> recs = 
            recommendationService.getPersonalizedRecommendations(query, 10);
        
        // 4. åå¤„ç†å’Œè¿‡æ»¤
        return postProcessRecommendations(recs, profile);
    }
}
```

## ğŸ¨ å‰ç«¯ç•Œé¢è¯´æ˜

### ä¸‰ä¸ªä¸»è¦æ ‡ç­¾é¡µ

1. **ä¸ªæ€§åŒ–æ¨è**
   - è¾“å…¥æŸ¥è¯¢å…³é”®è¯
   - å±•ç¤ºå¡ç‰‡å¼æ¨èç»“æœ
   - æ˜¾ç¤ºæ¨èåˆ†æ•°å’Œç†ç”±

2. **ç­–ç•¥å»ºè®®**
   - è¾“å…¥æ¸¸æˆåœºæ™¯æè¿°
   - è·å– AI ç”Ÿæˆçš„ç­–ç•¥åˆ†æ
   - æ”¯æŒæµå¼å®æ—¶æ˜¾ç¤º

3. **ä¸Šä¸‹æ–‡æ¨è**
   - å¯é€‰è¾“å…¥ä¸Šä¸‹æ–‡
   - è¾“å…¥å…·ä½“é—®é¢˜
   - è·å–ä¸ªæ€§åŒ–å›ç­”

### UI ç‰¹æ€§

- ğŸ¯ å“åº”å¼è®¾è®¡ï¼Œæ”¯æŒç§»åŠ¨ç«¯
- ğŸŒˆ æ¸å˜è‰²æ’åå¾½ç« 
- ğŸ“Š è¿›åº¦æ¡æ˜¾ç¤ºæ¨èåˆ†æ•°
- âš¡ å®æ—¶æµå¼å“åº”åŠ¨ç”»
- ğŸ’¡ ç¤ºä¾‹æŸ¥è¯¢å¿«é€Ÿå¼€å§‹

## ğŸ§ª æµ‹è¯•å»ºè®®

### å•å…ƒæµ‹è¯•

```java
@SpringBootTest
public class RecommendationServiceTest {
    
    @Autowired
    private RecommendationService recommendationService;
    
    @Test
    public void testPersonalizedRecommendations() {
        List<Recommendation> recs = 
            recommendationService.getPersonalizedRecommendations("ä½œç‰©", 5);
        
        assertNotNull(recs);
        assertTrue(recs.size() <= 5);
        
        for (Recommendation rec : recs) {
            assertNotNull(rec.getItemName());
            assertTrue(rec.getScore() >= 0 && rec.getScore() <= 1);
        }
    }
}
```

### é›†æˆæµ‹è¯•

```bash
# æµ‹è¯•ä¸ªæ€§åŒ–æ¨è
curl "http://localhost:8099/api/recommendation/personalized?query=ä½œç‰©&topK=3"

# æµ‹è¯•ç­–ç•¥å»ºè®®
curl -N "http://localhost:8099/api/recommendation/strategy?scenario=æ˜¥å­£æ–°æ‰‹"

# æµ‹è¯•ç›¸ä¼¼å†…å®¹
curl "http://localhost:8099/api/recommendation/similar?itemId=1&itemType=crop&topK=5"
```

## ğŸ”§ é«˜çº§é…ç½®

### è‡ªå®šä¹‰è¯„åˆ†ç®—æ³•

åœ¨ `RecommendationService.java` ä¸­ä¿®æ”¹ `calculateScore` æ–¹æ³•ï¼š

```java
private Double calculateScore(Document doc) {
    double baseScore = doc.getSimilarity();  // å‘é‡ç›¸ä¼¼åº¦
    double freshness = calculateFreshness(doc);  // æ–°é²œåº¦
    double popularity = calculatePopularity(doc);  // çƒ­é—¨åº¦
    
    // åŠ æƒå¹³å‡
    return baseScore * 0.5 + freshness * 0.3 + popularity * 0.2;
}
```

### æ·»åŠ ååŒè¿‡æ»¤

```java
/**
 * åŸºäºç”¨æˆ·è¡Œä¸ºçš„ååŒè¿‡æ»¤æ¨è
 */
public List<Recommendation> getCollaborativeRecommendations(String userId) {
    // 1. æ‰¾åˆ°ç›¸ä¼¼ç”¨æˆ·
    List<String> similarUsers = findSimilarUsers(userId);
    
    // 2. è·å–ä»–ä»¬å–œæ¬¢çš„å†…å®¹
    List<String> likedItems = getLikedItemsByUsers(similarUsers);
    
    // 3. è¿‡æ»¤ç”¨æˆ·å·²çŸ¥å†…å®¹
    List<String> candidates = filterKnownItems(userId, likedItems);
    
    // 4. è½¬æ¢ä¸ºæ¨èå¯¹è±¡
    return convertToRecommendations(candidates);
}
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. ç¼“å­˜ç­–ç•¥

```java
@Cacheable(value = "recommendations", key = "#query + '-' + #topK")
public List<Recommendation> getPersonalizedRecommendations(String query, int topK) {
    // ... å®ç°
}
```

### 2. æ‰¹é‡å¤„ç†

```java
public List<List<Recommendation>> batchRecommendations(List<String> queries) {
    return queries.parallelStream()
        .map(q -> getPersonalizedRecommendations(q, 5))
        .collect(Collectors.toList());
}
```

### 3. å¼‚æ­¥å¤„ç†

```java
@Async
public CompletableFuture<List<Recommendation>> getRecommendationsAsync(String query) {
    List<Recommendation> recs = getPersonalizedRecommendations(query, 5);
    return CompletableFuture.completedFuture(recs);
}
```

## ğŸ“ ç®€å†æ’°å†™å»ºè®®

### é¡¹ç›®æè¿°

```
å¼€å‘äº†åŸºäº Spring AI å’Œ Redis Vector Store çš„æ™ºèƒ½æ¨èç³»ç»Ÿï¼Œ
å®ç°äº†ä¸ªæ€§åŒ–å†…å®¹æ¨èã€ç­–ç•¥åˆ†æå’Œå¤šæ ·åŒ–è¿‡æ»¤ã€‚

æŠ€æœ¯äº®ç‚¹ï¼š
- ä½¿ç”¨å‘é‡ç›¸ä¼¼åº¦æœç´¢å®ç°è¯­ä¹‰æ¨èï¼ŒæŸ¥è¯¢å“åº”æ—¶é—´ < 500ms
- é›†æˆ OpenAI API è¿›è¡Œå®æ—¶ç­–ç•¥åˆ†æï¼Œæ”¯æŒ SSE æµå¼å“åº”
- å®ç°äº†æ¨èå¤šæ ·æ€§ç®—æ³•ï¼Œé¿å…åŒè´¨åŒ–æ¨è
- å‰ç«¯é‡‡ç”¨ Vue.js + Element UIï¼Œæä¾›æµç•…çš„ç”¨æˆ·ä½“éªŒ

æ ¸å¿ƒæˆæœï¼š
- æ¨èå‡†ç¡®ç‡æå‡ 40%ï¼ˆåŸºäºç”¨æˆ·åé¦ˆï¼‰
- å¹³å‡å“åº”æ—¶é—´ < 2 ç§’
- æ”¯æŒ 1000+ å¹¶å‘æŸ¥è¯¢
```

### é¢è¯•è¦ç‚¹

1. **æŠ€æœ¯é€‰å‹**
   - ä¸ºä»€ä¹ˆé€‰æ‹© Redis Vector Storeï¼Ÿ
   - å¦‚ä½•è¯„ä¼°æ¨èè´¨é‡ï¼Ÿ

2. **å®ç°ç»†èŠ‚**
   - å‘é‡ç›¸ä¼¼åº¦æœç´¢çš„åŸç†
   - SSE æµå¼å“åº”çš„ä¼˜åŠ¿
   - æ¨èå¤šæ ·æ€§çš„ç®—æ³•

3. **æ€§èƒ½ä¼˜åŒ–**
   - ç¼“å­˜ç­–ç•¥
   - æ‰¹é‡å¤„ç†
   - å¼‚æ­¥è°ƒç”¨

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤ PR æ¥æ”¹è¿›æ¨èç³»ç»Ÿï¼

### æ”¹è¿›æ–¹å‘

1. **ç®—æ³•ä¼˜åŒ–**
   - å®ç°ååŒè¿‡æ»¤
   - æ·»åŠ  A/B æµ‹è¯•
   - å¼ºåŒ–å­¦ä¹ ä¼˜åŒ–

2. **åŠŸèƒ½æ‰©å±•**
   - ç”¨æˆ·è¡Œä¸ºè¿½è¸ª
   - æ¨èè§£é‡Šæ€§
   - å¤šç›®æ ‡ä¼˜åŒ–

3. **æ€§èƒ½æå‡**
   - åˆ†å¸ƒå¼ç¼“å­˜
   - é¢„è®¡ç®—ä¼˜åŒ–
   - æŸ¥è¯¢ä¼˜åŒ–

## ğŸ“š å‚è€ƒèµ„æº

- [Spring AI æ–‡æ¡£](https://spring.io/projects/spring-ai)
- [Redis Vector Store](https://redis.io/docs/stack/search/reference/vectors/)
- [æ¨èç³»ç»Ÿå®è·µ](https://github.com/microsoft/recommenders)

## ğŸ“ æ›´æ–°æ—¥å¿—

### v1.0.0 (2024-10-20)
- âœ¨ åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- ğŸ¯ æ”¯æŒä¸ªæ€§åŒ–æ¨è
- ğŸ® æ”¯æŒç­–ç•¥å»ºè®®
- ğŸ’¬ æ”¯æŒä¸Šä¸‹æ–‡æ¨è

---

**Made with â¤ï¸ for Stardew Sage**
